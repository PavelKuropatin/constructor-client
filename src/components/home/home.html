<!--<div class="col-sm-3" ng-include="'partials/sidebar.html'" style="height:100%; overflow:scroll;"></div>-->

<div class="col-sm-3" style="height:100%">
    <div class="panel panel-success">
        <div class="panel-heading">
            <div class="pull-right btn-group">
                <button class="btn btn-default" ng-click="home.newState()">
                    <span class="glyphicon glyphicon-plus"></span>
                </button>
                <button class="btn btn-default"  ng-click="showjson=!showjson">
                    <span class="glyphicon glyphicon-info-sign"></span>
                </button>
            </div>
            <h3 class="panel-title">States</h3>
            <div style="clear:both;"></div>
        </div>
        <div class="panel-body">
            <div ng-if="!showjson">
                <div ng-repeat="state in home.stateObjects">

                    <div class="panel panel-warning">
                        <div class="panel-heading">
                            <div class="pull-right btn-group">
                                <button class="btn btn-default" ng-click="home.setActiveState(state)">
                                    <span class="glyphicon glyphicon-minus" ></span>
                                </button>
                                <button class="btn btn-default" ng-click="home.removeState(state)">
                                    <span class="glyphicon glyphicon-trash"></span>
                                </button>
                            </div>
                            <h3 class="panel-title">{{state.name}}</h3>
                            <div style="clear:both;"></div>
                        </div>
                        <div ng-hide="home.activeState != state" class="panel-body">
                            <div class="row">
                                <label class="col-sm-6">Name of State</label>
                                <div class="col-sm-6">
                                    <input type="text" class="form-control" ng-model="state.name"/>
                                </div>
                            </div>

                            <div style="clear:both; margin:5px;"></div>
                            <div class="row">
                                <label class="col-sm-6">Template</label>
                                <div class="col-sm-6">
                                    <select class="form-control" ng-model="state.template">
                                        <option>default</option>
                                        <option>secondary</option>
                                        <option>action</option>
                                    </select>
                                </div>

                            </div>
                            <div style="clear:both; margin:5px;"></div>
                            <div class="row">
                                <div class="pull-right col-sm-6">
                                    <small style="font-size:8px;">
                                        Position: [ <strong>{{state.x| number}}, {{state.y| number}}</strong> ]
                                    </small>
                                </div>
                            </div>
                            <div style="clear:both; margin:5px;"></div>
                            <div ng-repeat="source in state.sources">


                                <div class="panel panel-success">
                                    <div class="panel-heading">
                                        <div class="pull-right btn-group">
                                            <button class="btn btn-default">
                                                <small>UUID {{source.uuid}}</small>
                                            </button>
                                            <button class="btn btn-default" ng-click="home.removeIndex($index, state.sources);">
                                                <span class="glyphicon glyphicon-trash"></span>
                                            </button>
                                        </div>
                                        <h3 class="panel-title">UUID<br><small style="font-size:8px;">SOURCE</small></h3>
                                        <div style="clear:both;"></div>
                                    </div>
                                    <div class="panel-body">


                                        <div ng-repeat="connection in source.connections" ng-class="{'btn-warning': connection.mouseover}" style="padding:5px;">
                                            <div class="btn-group btn-group-justified">
                                                <!--<div class="btn-group">-->
                                                    <!--<button ng-if="connection.type != 'Action'" class="btn btn-default" ng-click="connection.type = 'Action'">-->
                                                        <!--<span style="color:#3860ff;" class="glyphicon glyphicon-retweet" title="Transition To {{connection.uuid}}"></span>-->
                                                    <!--</button>-->
                                                    <!--<button ng-if="connection.type == 'Action'" class="btn btn-default" ng-click="connection.type = 'Transition'">-->
                                                        <!--<span style="color:#ff7805;" class="glyphicon glyphicon-flash" title="Trigger Action {{connection.uuid}}"></span>-->
                                                    <!--</button>-->
                                                <!--</div>-->
                                                <div class="btn-group">
                                                    <button class="btn btn-default" ng-click="alert('ah, no action here')">
                                                        <span class="glyphicon glyphicon glyphicon-hand-right"></span>
                                                    </button>
                                                </div>
                                                <div class="btn-group">
                                                    <button class="btn btn-default" ng-click="home.removeIndex($index, source.connections)">
                                                        <span class="glyphicon glyphicon-trash"></span>
                                                    </button>
                                                </div>

                                            </div>
                                            <div class="col-sm-12" style="padding:5px;">
                                                <label class="col-sm-6">
                                                    Condition
                                                </label>
                                                <div class="col-sm-6">
                                                    <input type="text" class="form-control" ng-model="connection.condition"/>
                                                </div>
                                            </div>
                                            <div style="clear:both"></div>
                                        </div>

                                    </div>
                                </div>
                            </div>


                            <div ng-repeat="target in state.targets">

                                <div class="panel panel-danger">
                                    <div class="panel-heading">
                                        <div class="pull-right btn-group">
                                            <button class="btn btn-default">
                                                <small>UUID {{target.uuid}}</small>
                                            </button>
                                            <button class="btn btn-default" ng-click="home.removeIndex($index, state.targets);">
                                                <span class="glyphicon glyphicon-trash"></span>
                                            </button>
                                        </div>
                                        <h3 class="panel-title">UUID<br><small style="font-size:8px;">TARGET</small></h3>
                                        <div style="clear:both;"></div>
                                    </div>
                                    <!--<div class="panel-body"> </div>-->
                                </div>


                            </div>

                        </div>
                    </div>

                </div>
            </div>
            <textarea style="width:100%; height:400px;" ng-if="showjson">{{home.stateObjects | json }}</textarea>
        </div>
    </div>
</div>

<div id="container" class="col-sm-9" style="height:100%; overflow:hidden;">
    <div class="panel panel-primary" style="height:100%;">
        <div class="panel-heading">
            <h3 class="panel-title">
                jsPlumb Canvas 1 ({{home.pos_x}}, {{home.pos_y}}, {{home.zoomlevel}})
                <!--<div class="col-sm-4 pull-right">-->
                <md-slider min="0" max="200" ng-model="home.zoomlevel" step="10" aria-label="red" id="red-slider"
                           class="md-warn">
                </md-slider>
                <!--</div>-->
            </h3>
        </div>
        <div class="panel-body" style="overflow:hidden; height:100%;">
            <js-plumb-canvas on-connection="home.onConnection" x="home.pos_x" y="home.pos_y" zoom="home.zoomlevel">
                <!--<js-plumb-object state-object="state" ng-style="{ 'left':state.x, 'top':state.y }" class="state_window" style="background-color:blue;" ng-repeat="state in home.stateObjects">-->
                    <!--<div style="position:absolute; top:-10px; left:0px;">-->
                        <!--<div ng-repeat="endpoint in state.sources" class="col-sm-1">-->
                            <!--<js-plumb-endpoint anchor="TopCenter" uuid="{{endpoint.uuid}}" settings="home.sourceEndpointStyle">-->
                                <!--<js-plumb-connection ng-click="home.setActiveConnection($index)" ng-repeat="connection in endpoint.connections" ng-model="connection">-->
                                    <!--&lt;!&ndash; we can have html content in here... inside the directive I attempt to attach it to the connection label, which works somewhat, but once you delete a connection it reverts to unwanted behavior &ndash;&gt;-->
                                <!--</js-plumb-connection>-->
                            <!--</js-plumb-endpoint>-->
                        <!--</div>-->
                        <!--<div ng-repeat="endpoint in state.targets" class="col-sm-1">-->
                            <!--<js-plumb-endpoint anchor="TopCenter" uuid="{{endpoint.uuid}}" settings="home.targetEndpointStyle"></js-plumb-endpoint>-->
                        <!--</div>-->
                    <!--</div>-->
                    <!--<h3 style="color:white;" ng-click="home.setActiveState(state)">{{state.name}}</h3>-->
                <!--</js-plumb-object>-->


                <js-plumb-object state-object="state" ng-style="{ 'left':state.x, 'top':state.y }" class="state_window" ng-repeat="state in home.stateObjects">
                    <h3 ng-click="home.setActiveState(state)">{{state.name}}</h3>
                    {{state.template}}
                    <div style="position:absolute; top:50%; right:0px;">
                        <js-plumb-endpoint ng-repeat="endpoint in state.sources" anchor="RightMiddle"
                                           uuid="{{endpoint.uuid}}" settings="home.sourceEndpointStyle">
                            <js-plumb-connection ng-click="setActiveConnection($index)"
                                                 ng-repeat="connection in endpoint.connections" ng-model="connection">
                                <!--<div style="background-color:#ccc; border-radius:20px; width:40px; text-align:center; height:40px; position:relative; top:-20px; left:-20px;">-->
                                    <!--<span ng-if="connection.type != 'Action'"-->
                                          <!--style="margin-top:5px; color:#3860ff; font-size:25px;"-->
                                          <!--class="glyphicon glyphicon-retweet"-->
                                          <!--title="Transition To {{connection.uuid}}"></span>-->
                                    <!--<span ng-if="connection.type == 'Action'"-->
                                          <!--style="margin-top:5px;color:#ff7805; font-size:25px;"-->
                                          <!--class="glyphicon glyphicon-flash"-->
                                          <!--title="Trigger Action {{connection.uuid}}"></span>-->
                                <!--</div>-->
                            </js-plumb-connection>
                        </js-plumb-endpoint>
                    </div>
                    <div style="position:absolute; top:50%; left:0px;">
                        <js-plumb-endpoint ng-repeat="endpoint in state.targets" anchor="LeftMiddle"
                                           uuid="{{endpoint.uuid}}"
                                           settings="home.targetEndpointStyle"></js-plumb-endpoint>
                    </div>
                </js-plumb-object>
            </js-plumb-canvas>
        </div>

        <!--<div class="panel-body" style="overflow:hidden; height:100%;">-->
        <!--<js-plumb-canvas on-connection="home.onConnection" x="home.pos_x" y="home.pos_y" zoom="home.zoomlevel">-->
        <!--<js-plumb-object state-object="state" ng-style="{ 'left':state.x, 'top':state.y }" class="state_window" ng-repeat="state in home.states">-->
        <!--<span>{{state.name}}</span>-->
        <!--<js-plumb-endpoint ng-repeat="endpoint in state.sources" anchor="{{endpoint.position}}" uuid="{{endpoint.uuid}}" settings="sourceEndpointStyle"></js-plumb-endpoint>-->
        <!--<js-plumb-endpoint ng-repeat="endpoint in state.targets" anchor="{{endpoint.position}}" uuid="{{endpoint.uuid}}" settings="home.targetEndpointStyle"></js-plumb-endpoint>-->
        <!--</js-plumb-object>-->
        <!--</js-plumb-canvas>-->
        <!--</div>-->
    </div>
</div>
